upstream dancerfly {
    server localhost:8000 fail_timeout=0;
}

server {

    listen       80 default;
    server_name  {{ pillar['deploy']['server_name'] }};

    client_max_body_size  4G;
    keepalive_timeout     5;

    access_log  {{ pillar['files']['logs']['nginx']['access'] }};
    error_log   {{ pillar['files']['logs']['nginx']['error'] }};

    include  {{ pillar['files']['nginx_app_conf'] }};
}

server {

    listen       443;
    server_name  {{ pillar['deploy']['server_name'] }};

    client_max_body_size  4G;
    keepalive_timeout     70;

    access_log  {{ pillar['files']['logs']['nginx']['ssl_access'] }};
    error_log   {{ pillar['files']['logs']['nginx']['ssl_error'] }};

    ssl                  on;
    ssl_certificate      {{ pillar['files']['crt_dir'] }}dancerfly.crt;
    ssl_certificate_key  {{ pillar['files']['crt_dir'] }}dancerfly.key;
    ssl_protocols        TLSv1 TLSv1.1 TLSv1.2;
    ssl_ciphers          HIGH:!aNULL:!MD5;

    include  {{ pillar['files']['nginx_app_conf'] }};
}

